---
title: "Olympic 2020"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    theme:
      version: 4
      bootswatch: lumen
      base_font: !expr bslib::font_google("Prompt")
      code_font: !expr bslib::font_google("Poppins")
---


```{r, include=FALSE}
library(readr)
library(readxl)
library(ggplot2)
library(flexdashboard)
library(tidyr)
library(dplyr)
library(highcharter)
library(plotly)
library(janitor)
library(bslib)
library(thematic)
library(knitr)

theme_set(theme_bw(base_size = 20))
```

```{r load data, message=FALSE, warning=FALSE}
athletes <- read_excel("data/Athletes.xlsx") %>% clean_names()
entry_gender <- read_excel("data/EntriesGender.xlsx")%>% clean_names
coaches <- read_excel("data/Coaches.xlsx") %>% clean_names()
medals <- read_excel("data/Medals.xlsx",
                         col_types = c("numeric", "text", "numeric", 
                                       "numeric", "numeric", "numeric", 
                                       "numeric")) %>% clean_names()
teams <- read_excel("data/Teams.xlsx") %>% clean_names()
```



```{r metrics analytics}
total_athletes <- athletes%>%nrow()
#total_coach <- coaches %>% nrow()
total_medal <- sum(medals$total)
total_country <- athletes %>% distinct(noc)%>%nrow()
total_games <- athletes %>% distinct(discipline)%>%nrow()
```

Summary
===================================== 


Value Boxes {data-width=200}
-------------------------------------

### Atheletes

```{r}
valueBox(total_athletes, caption = "Atheletes", icon = "fa-users")
```

### Country 

```{r}
valueBox(total_country, caption = "Country", color = "info", icon = "fa-flag")
```

### Games

```{r}
valueBox(total_games, caption = "Games", color = "success", icon = "fa-trophy")
```

### Medals

```{r}
valueBox(total_medal, caption = "Medals", color = "warning", icon = "fa-star")
```


3rd Party Outputs {.tabset data-height=700}
-------------------------------------


### Total Athletes Based on Country
    
```{r}
athletes_country <- read_csv("data/athletes_country.csv")


hcmap(
  "custom/world-robinson-highres", 
  data = athletes_country,
  name = "Total Athletes", 
  value = "count",
  borderWidth = 0,
  nullColor = "#d3d3d3",
  joinBy = c("iso-a3", "iso3")
  ) %>%
  hc_colorAxis(
    stops = color_stops(colors = viridisLite::inferno(10, begin = 0.1))
    ) 
```

### Total Coach Based on Country
    
```{r}
athletes_country <- read_csv("data/athletes_country.csv")

coach_country <- coaches %>% group_by(noc) %>%
  summarise(coach_count = n())

coach_country <- coach_country %>% left_join(athletes_country, by= "noc") %>% select(iso3,noc,coach_count)

hcmap(
  "custom/world-robinson-highres", 
  data = coach_country,
  name = "Total Coach", 
  value = "coach_count",
  borderWidth = 0,
  nullColor = "#d3d3d3",
  joinBy = c("iso-a3", "iso3")
  ) %>%
  hc_colorAxis(
    stops = color_stops(colors = viridisLite::inferno(10, begin = 0.1))
    ) 
```


### Total Medal Based on Country
    
```{r}
athletes_country <- read_csv("data/athletes_country.csv")
medal_country <- medals%>% left_join(athletes_country, by = c("team_noc"= "noc")) %>%
  select(iso3,team_noc,total)

hcmap(
  "custom/world-robinson-highres", 
  data = medal_country,
  name = "Total Medals", 
  value = "total",
  borderWidth = 0,
  nullColor = "#d3d3d3",
  joinBy = c("iso-a3", "iso3")
  ) %>%
  hc_colorAxis(
    stops = color_stops(colors = viridisLite::inferno(10, begin = 0.1))
    ) 
```


Row 
-------------------------------------

### Country
    
```{r}
table_data <- athletes_country %>%
  left_join(coach_country,by="iso3")%>%
  left_join(medal_country,by="iso3")%>%
  select(`noc.x`,count,coach_count, total) %>%
  rename('NOC'='noc.x','Players'='count','Coach'='coach_count','Medals' ='total') %>%
  replace(is.na(.), 0)

knitr::kable(table_data)
```



Storyboard {.storyboard}
=========================================

### Static Plots

```{r}
p <- ggplot(faithfuld, aes(waiting, eruptions, z = density)) + 
  geom_raster(aes(fill = density)) +
  geom_contour() +
  ggtitle("2d density estimate of Old Faithful data")

renderPlot(p)
```

*** 

Put `thematic_rmd()` for auto-plot theming!

### Interactive Plots

```{r}
library(plotly)
plotlyOutput("plotly")
```

```{r}
output$plotly <- renderPlotly({
  cd <- session$clientData
  ggplotly(p, height = cd$output_plotly_height, width = cd$output_plotly_width)
})
```

*** 

`thematic_rmd()` also works with `ggplotly()`!

### Learn more


```{r}

```

Cards
=====================================     
   
Row {data-height=300}
-------------------------------------

### Basic card

Some descriptive text here.


### 

No header should appear above. Content should be overflowing

```{r, echo = TRUE}
# Some pretty R code
str(mtcars)
```




Row
-------------------------------------
   
### Primary background {.bg-primary}

This 'card' has a `.bg-primary` class.

### Secondary background {.bg-secondary}

This 'card' has a `.bg-secondary` class (only supported in BS4+).
